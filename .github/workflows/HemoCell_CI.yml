name: HemoCell_CI

on:
  push:
    branches: 
      - develop
      - setup_cicd
  pull_request:
    branches: 
      - develop
      - setup_cicd

jobs:

  hemocell_ci_workflow:

    runs-on: self-hosted

    steps:
    - uses: actions/checkout@v3
    - name: Install hemocell dependencies and create artifacts
      run: |
        sudo apt-get update --yes -qq
        sudo apt-get install --yes -qq git g++ cmake make libopenmpi-dev libhdf5-mpi-dev libhdf5-dev patch wget ccache
        ./setup.sh > /dev/null
        mkdir -p build && cd build
        cmake ..
      
    - name : build hemocell and examples
      run : |
        cd build
        while read target; do
          cmake --build . --target ${target}
        done < <(cut -d '"' -f2 < ../examples/CMakeLists.txt)
        
      
  
